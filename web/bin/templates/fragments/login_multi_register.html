<div n:if="$type">
    <form class=" "
          onsubmit="post_register_shop($(this).serialize());return false;">
        <input name="emailClient" type="hidden" value="{$emailCommande}">
        <input name="nomClient" type="hidden" value="{$nomCommande}">
        <input name="prenomClient" type="hidden" value="{$prenomCommande}">
        <input name="telephoneClient" type="hidden" value="{$telephoneCommande}">
        <input name="adresseClient" type="hidden" value="{$adresseCommande}">
        <input name="adresse2Client" type="hidden" value="{$adresse2Commande}">
        <input name="codePostalClient" type="hidden" value="{$codePostalCommande}">
        <input name="villeClient" type="hidden" value="{$villeCommande}">
        <input name="afterAction" type="hidden" value="/commande/etape_paiement">

        <div class=" ">
            <div class=" ">
                <div class="padding">
                    <div class="padding_more boxshadowb text-bold h6">
                        Saisie d'un mot de passe pour la création d'un compte client
                    </div>
                    <div class="padding">
                        Vous pouvez <span class="text-bold">créer un compte</span> en saisissant un mot de passe, ou
                        cliquer sur<span class="text-bold"> continuer</span><br>
                        Merci d'utiliser <span id="errorS">au minimum 5 </span> <span id="errorN">chiffres</span> et
                        <span id="errorL">lettres</span>
                    </div>
                    <table class="unstriped   unbordered">
                        <tr>
                            <td>
                                <div class="  text-bold"> Mot de passe
                                </div>
                            </td>
                            <td>
                                <input id="passtocheck" name="passwordClient" type="password" placeholder="Mot de passe"
                                       required>
                            </td>
                        </tr>
                        <tr>
                            <td class="padding text-bold">Vérification mot de passe</td>
                            <td>
                                <input id="passtocheck_verif" name="passwordClient_verif" type="password"
                                       placeholder="Vérification mot de passe" required>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="text-center">
                                <div class="flex_h flex_align_middle">
                                    <div class="flex_main">
                                        <button class="button" disabled="disabled" id="btn_checkpass"
                                                type="submit">Valider et continuer
                                        </button>
                                    </div>
                                    <div class="flex_main">
                                        <button id="btn_directpass"
                                                onclick="document.location.href = '/commande/etape_paiement';"
                                                class="button" type="button"> continuer
                                        </button>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <input type="hidden" name="HTTP_REFERER" value="{$HTTP_REFERER}">
    </form>
    <div class="padding color-base-dark text-center">
        <p>Aprés avoir correctement rempli les champs, cliquez sur le bouton continuer ma commande</p>
    </div>
    <button class="close-button" data-close aria-label="Close reveal" type="button">
        <i aria-hidden="true" class="fa fa-times" style="vertical-align: middle;"></i>
    </button>
</div>
<script>
    (function () {

        var ZXCVBN_SRC = 'https://tac-tac.shop.mydde.fr/js/vendor/zxcvbn.js';

        var async_load     = function () {
            var first, s;
            s       = document.createElement('script');
            s.src   = ZXCVBN_SRC;
            s.type  = 'text/javascript';
            s.async = true;
            first   = document.getElementsByTagName('script')[0];
            return first.parentNode.insertBefore(s, first);
        };
        var async_verif    = function () {
            $('#passtocheck').on('keyup', function () {
                const degree = zxcvbn(this.value);
                const score  = degree.score

                if (!$('#weakness_passcheck').length) {
                    div           = document.createElement('div');
                    div.id        = 'weakness_passcheck';
                    div.className = 'flex_h flex_padding'
                    this.parentNode.insertBefore(div, this.nextSibling);
                    div.innerHTML = '<div class="flex_main text-center none"><progress id="weakness_passcheck_progr" value="' + score + '" max="5"></progress></div><div class="flex_main"></div>'
                }
                const prog = document.getElementById('weakness_passcheck_progr');
                //const btn_check = document.getElementById ('btn_checkpass');
                prog.value = eval(score);

                async_validate();
                /*if((score >= 1) && document.getElementById ('passtocheck_verif').value == document.getElementById ('passtocheck').value){
                 btn_check.disabled = false;
                 }else{
                 btn_check.disabled = true;
                 }*/
            });
            $('#passtocheck_verif').on('keyup', function () {
                async_validate();
                /*if ( (document.getElementById ('weakness_passcheck_progr').value >= 1) && document.getElementById ('passtocheck_verif').value == document.getElementById ('passtocheck').value ) {
                 document.getElementById ('btn_checkpass').disabled = false;
                 } else {
                 document.getElementById ('btn_checkpass').disabled = true;
                 }*/
            })

        }
        var async_validate = function () {
            const hasN      = /\d+/.test(document.getElementById('passtocheck').value);
            const hasL      = /[a-zA-Z]/.test(document.getElementById('passtocheck').value);
            const isSame    = document.getElementById('passtocheck_verif').value == document.getElementById('passtocheck').value
            const hasScore  = document.getElementById('weakness_passcheck_progr').value >= 1;
            const hasLength = document.getElementById('passtocheck').value.length > 5;

            const JQ = jQuery;
            //JQ('#errorN','#errorL','#errorS').hide()
            // console.log (hasN, hasL, isSame, hasScore, hasLength);

            if (hasN && hasL && isSame && hasScore && hasLength) {
                document.getElementById('btn_checkpass').disabled = false;
                $('#btn_directpass').hide();
            } else {
                document.getElementById('btn_checkpass').disabled = true;
                $('#btn_directpass').show();
            }

        }
        /*if ( window.attachEvent != null ) {
         window.attachEvent ('onload', async_load);
         } else {
         window.addEventListener ('load', async_load, false);
         }*/

        async_load()
        async_verif();

    }).call(this);
</script>
<style>
    .login_input_zone {
        /*padding: 0 3rem;*/
        max-width: 350px;
        margin: 0 auto;
        position: relative;
    }
</style>